using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class HitInvulnerability : MonoBehaviour
{
    bool _isInvulnerable = false;
    PlayerMovement playerMovement;
    int currentHealth;
    private float timeBetweenDmg;
    private float startTimeBetweenDmg;

    [SerializeField]
    private int InvulnerableTimer;

    // Start is called before the first frame update
    private SpriteRenderer playerSprite;

    void Start()
    {
        playerMovement = GetComponent<PlayerMovement>();
        currentHealth = playerMovement.currentHealth;
        playerSprite = GetComponent<SpriteRenderer>();
    }

    // Update is called once per frame
    void Update() { }

    public void TryTakeDamage(int damage)
    {
        if (_isInvulnerable)
            return;
        else
        {
            TakeDamage(damage);
            StartCoroutine(StartInvulnerabilityTimer());
        }
    }

    IEnumerator StartInvulnerabilityTimer()
    {
        _isInvulnerable = true;
        Color playerSpriteColor = playerSprite.color;
        playerSpriteColor.a = 0.5f;
        playerSprite.color = playerSpriteColor;
        gameObject.layer = LayerMask.NameToLayer("PlayerInvulnerable");
        yield return new WaitForSeconds(InvulnerableTimer);
        gameObject.layer = LayerMask.NameToLayer("Player");
        _isInvulnerable = false;
        playerSpriteColor.a = 1;
        playerSprite.color = playerSpriteColor;
    }

    public void TakeDamage(int damage)
    {
        playerMovement.UpdateHealth(-damage);
    }
}
